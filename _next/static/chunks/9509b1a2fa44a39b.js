(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,20446,e=>{"use strict";var t=e.i(43476),a=e.i(71645);function r({pixels:e,scale:r=1,showGrid:n=!1,gridColor:i="#4a4a4a",gridThickness:o=1,foregroundColor:l="#ffffff",backgroundColor:s="#000000",onPixelClick:c,onPixelDrag:u,onDragEnd:d,onPixelHover:f,onPixelLeave:h,className:m="",interactive:E=!0,mixedPixels:g,mixedColor:A="#666666",diffPixels:R,diffColor:y="#ff3333",scanlinesIntensity:w=0,bloomIntensity:b=0}){let C=(0,a.useRef)(null),[_,p]=(0,a.useState)(!1),T=(0,a.useRef)(null),S=e.length,O=e[0]?.length||0,I=n?o:0,v=O*r+(n?(O+1)*o:0),D=S*r+(n?(S+1)*o:0);(0,a.useEffect)(()=>{let t=C.current;if(!t)return;let a=t.getContext("2d");if(!a)return;a.fillStyle=s,a.fillRect(0,0,v,D);let c=b>0;c&&(a.shadowColor=l,a.shadowBlur=b/100*r*2);for(let t=0;t<S;t++)for(let i=0;i<O;i++){let u=n?i*(r+o)+o:i*r,d=n?t*(r+o)+o:t*r,f=`${t},${i}`,h=g?.has(f),m=R?.has(f),E=e[t]?.[i]||!1;if(h){c&&(a.shadowBlur=0);let e=Math.floor(r/2);a.fillStyle=l,a.fillRect(u,d,e,e),a.fillRect(u+e,d+e,r-e,r-e),a.fillStyle=s,a.fillRect(u+e,d,r-e,e),a.fillRect(u,d+e,e,r-e),c&&(a.shadowBlur=b/100*r*2)}else m?(c&&(a.shadowBlur=0),a.fillStyle=y,a.fillRect(u,d,r,r),c&&(a.shadowBlur=b/100*r*2)):(a.fillStyle=E?l:s,c&&!E&&(a.shadowBlur=0),a.fillRect(u,d,r,r),c&&!E&&(a.shadowBlur=b/100*r*2))}if(c&&(a.shadowBlur=0),w>0){let e=w/100*.5;if(a.fillStyle=`rgba(0, 0, 0, ${e})`,n)for(let e=0;e<S;e++)for(let t=0;t<O;t++){let n=t*(r+o)+o,i=e*(r+o)+o;for(let e=0;e<r;e+=2)a.fillRect(n,i+e,r,1)}else for(let e=0;e<D;e+=2)a.fillRect(0,e,v,1)}if(n){a.fillStyle=i;for(let e=0;e<=O;e++){let t=e*(r+o);a.fillRect(t,0,o,D)}for(let e=0;e<=S;e++){let t=e*(r+o);a.fillRect(0,t,v,o)}}},[e,r,n,i,o,l,s,v,D,O,S,g,A,R,y,w,b]);let k=(0,a.useCallback)(e=>{let t,a,i=C.current;if(!i)return null;let l=i.getBoundingClientRect();if("touches"in e){if(0===e.touches.length)return null;t=e.touches[0].clientX,a=e.touches[0].clientY}else t=e.clientX,a=e.clientY;let s=t-l.left,c=a-l.top,u=i.width/l.width,d=i.height/l.height,f=r+(n?o:0),h=Math.floor((s*u-I)/f),m=Math.floor((c*d-I)/f);return m>=0&&m<S&&h>=0&&h<O?{row:m,col:h}:null},[r,n,o,I,S,O]),B=(0,a.useCallback)(e=>{if(!E)return;2===e.button&&e.preventDefault();let t=k(e);t&&c&&(c(t.row,t.col,2===e.button),T.current=t,p(!0))},[E,k,c]),x=(0,a.useCallback)(e=>{E&&e.preventDefault()},[E]),N=(0,a.useCallback)(e=>{if(!E)return;let t=k(e);t&&f&&f(t.row,t.col),_&&u&&t&&(!T.current||T.current.row!==t.row||T.current.col!==t.col)&&(u(t.row,t.col),T.current=t)},[E,_,k,u,f]),P=(0,a.useCallback)(()=>{_&&(p(!1),T.current=null,d?.())},[_,d]),M=(0,a.useCallback)(()=>{_&&(p(!1),T.current=null,d?.()),h?.()},[_,d,h]),L=(0,a.useRef)(E),H=(0,a.useRef)(c),F=(0,a.useRef)(u),z=(0,a.useRef)(d),j=(0,a.useRef)(_);return(0,a.useEffect)(()=>{L.current=E},[E]),(0,a.useEffect)(()=>{H.current=c},[c]),(0,a.useEffect)(()=>{F.current=u},[u]),(0,a.useEffect)(()=>{z.current=d},[d]),(0,a.useEffect)(()=>{j.current=_},[_]),(0,a.useEffect)(()=>{let e=C.current;if(!e)return;let t=t=>{if(0===t.touches.length)return null;let a=e.getBoundingClientRect(),i=t.touches[0].clientX,l=t.touches[0].clientY,s=i-a.left,c=l-a.top,u=e.width/a.width,d=e.height/a.height,f=r+(n?o:0),h=Math.floor((s*u-I)/f),m=Math.floor((c*d-I)/f);return m>=0&&m<S&&h>=0&&h<O?{row:m,col:h}:null},a=e=>{if(!L.current)return;e.preventDefault();let a=t(e);a&&H.current&&(H.current(a.row,a.col),T.current=a,p(!0))},i=e=>{if(!L.current||!j.current||!F.current)return;e.preventDefault();let a=t(e);a&&(!T.current||T.current.row!==a.row||T.current.col!==a.col)&&(F.current(a.row,a.col),T.current=a)},l=()=>{j.current&&(p(!1),T.current=null,z.current?.())};return e.addEventListener("touchstart",a,{passive:!1}),e.addEventListener("touchmove",i,{passive:!1}),e.addEventListener("touchend",l),()=>{e.removeEventListener("touchstart",a),e.removeEventListener("touchmove",i),e.removeEventListener("touchend",l)}},[r,n,o,I,S,O]),(0,t.jsx)("canvas",{ref:C,width:v,height:D,className:`${E?"cursor-crosshair":""} ${m}`,style:{imageRendering:"pixelated",touchAction:"none"},onMouseDown:B,onMouseMove:N,onMouseUp:P,onMouseLeave:M,onContextMenu:x})}e.s(["PixelGrid",()=>r])},60951,e=>{"use strict";e.s(["CHARACTER_EDITOR_SNAPSHOTS_STORE",0,"character-editor-snapshots","CHARACTER_EDITOR_STORAGE_KEY_AUTOSAVE",0,"retrostack-character-editor-autosave","CHARACTER_EDITOR_STORAGE_KEY_COLOR_PRESET",0,"retrostack-character-editor-color-preset","CHARACTER_EDITOR_STORAGE_KEY_CRT_SETTINGS",0,"retrostack-character-editor-crt-settings","CHARACTER_EDITOR_STORAGE_KEY_CUSTOM_COLORS",0,"retrostack-character-editor-custom-colors","CHARACTER_EDITOR_STORAGE_KEY_FALLBACK",0,"retrostack-character-editor-sets","CHARACTER_EDITOR_STORAGE_KEY_ONBOARDING",0,"retrostack-character-editor-onboarding","CHARACTER_EDITOR_STORAGE_KEY_PAGE_SIZE",0,"retrostack-character-editor-page-size","CHARACTER_EDITOR_STORAGE_KEY_SORT_DIRECTION",0,"retrostack-character-editor-sort-direction","CHARACTER_EDITOR_STORAGE_KEY_SORT_FIELD",0,"retrostack-character-editor-sort-field","CHARACTER_EDITOR_STORAGE_KEY_TIPS_OVERLAY",0,"retrostack-character-editor-tips-overlay","CHARACTER_EDITOR_STORE_NAME",0,"character-editor-sets","DB_NAME",0,"retrostack-web","DB_VERSION",0,9])},33712,e=>{"use strict";function t(e){return Math.ceil(e/8)}function a(e){return t(e.width)*e.height}function r(e){let t=e.binaryData,r=0;t.endsWith("==")?r=2:t.endsWith("=")&&(r=1);let n=3*t.length/4-r,i=a(e.config);return i>0?Math.floor(n/i):0}function n(e,t){let a=[];for(let r=0;r<t;r++)a.push(Array(e).fill(!1));return{pixels:a}}function i(e){return{pixels:e.pixels.map(e=>[...e])}}function o(){return{width:8,height:8,padding:"right",bitDirection:"ltr"}}function l(){return crypto.randomUUID()}e.s(["bytesPerCharacter",()=>a,"bytesPerLine",()=>t,"cloneCharacter",()=>i,"createDefaultConfig",()=>o,"createEmptyCharacter",()=>n,"generateId",()=>l,"getCharacterCount",()=>r])},94136,e=>{"use strict";var t=e.i(33712);function a(e,a){let{width:r,height:n,padding:i,bitDirection:o}=a,l=(0,t.bytesPerLine)(r),s=new Uint8Array(n*l);for(let t=0;t<n;t++){let a=8*l,n=a-r,c=Array(a).fill(!1);for(let a=0;a<r;a++){let l=e.pixels[t]?.[a]||!1;c["ltr"===o?("left"===i?n:0)+a:("left"===i?n:0)+(r-1-a)]=l}for(let e=0;e<l;e++){let a=0;for(let t=0;t<8;t++)c[8*e+t]&&(a|=1<<7-t);s[t*l+e]=a}}return s}function r(e,a){let r=e instanceof Uint8Array?e:new Uint8Array(e),n=(0,t.bytesPerCharacter)(a),i=Math.floor(r.length/n),o=[];for(let e=0;e<i;e++){let i=r.slice(e*n,(e+1)*n);o.push(function(e,a){let{width:r,height:n,padding:i,bitDirection:o}=a,l=(0,t.bytesPerLine)(r),s=[];for(let t=0;t<n;t++){let a=t*l,n=8*l-r,c=[];for(let t=0;t<l;t++){let r=e[a+t]||0;for(let e=0;e<8;e++)c.push((r&1<<7-e)!=0)}let u=[];for(let e=0;e<r;e++){let t;t="ltr"===o?("left"===i?n:0)+e:("left"===i?n:0)+(r-1-e),u.push(c[t])}s.push(u)}return{pixels:s}}(i,a))}return o}function n(e,r){let n=(0,t.bytesPerCharacter)(r),i=new Uint8Array(e.length*n);for(let t=0;t<e.length;t++){let o=a(e[t],r);i.set(o,t*n)}return i}function i(e){let t="";for(let a=0;a<e.length;a++)t+=String.fromCharCode(e[a]);return btoa(t)}function o(e){let t=atob(e),a=new Uint8Array(t.length);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);return a}function l(e){let t=n(e.characters,e.config);return{metadata:e.metadata,config:e.config,binaryData:i(t)}}function s(e){let t=r(o(e.binaryData),e.config);return{metadata:e.metadata,config:e.config,characters:t}}function c(e,t,a){return new Blob([n(e,{...t,...a}).buffer],{type:"application/octet-stream"})}function u(e,t){let a=URL.createObjectURL(e),r=document.createElement("a");r.href=a,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)}e.s(["base64ToBinary",()=>o,"binaryToBase64",()=>i,"characterToBytes",()=>a,"createDownloadBlob",()=>c,"deserializeCharacterSet",()=>s,"downloadBlob",()=>u,"parseCharacterRom",()=>r,"serializeCharacterRom",()=>n,"serializeCharacterSet",()=>l])},92832,e=>{"use strict";var t=e.i(33712),a=e.i(60951);let r={isCorrupted:!1},n=new Set;function i(e){return n.add(e),r.isCorrupted&&e(r),()=>{n.delete(e)}}function o(){return{...r}}function l(e){r={isCorrupted:!0,errorMessage:e},n.forEach(e=>e(r))}function s(){r={isCorrupted:!1}}function c(e){if(e instanceof DOMException){if(["InvalidStateError","UnknownError","DataError","ConstraintError","AbortError"].includes(e.name))return!0;let t=e.message?.toLowerCase()??"";if(t.includes("corrupt")||t.includes("invalid")||t.includes("database")||t.includes("version"))return!0}return!1}async function u(){try{f.db&&(f.db.close(),f.db=null),await new Promise((e,t)=>{let r=indexedDB.deleteDatabase(a.DB_NAME);r.onsuccess=()=>{s(),e()},r.onerror=()=>{t(Error("Failed to delete database"))},r.onblocked=()=>{s(),e()}}),window.location.reload()}catch(e){console.error("Failed to reset database:",e),window.location.reload()}}function d(){return{getItem(e){try{return localStorage.getItem(e)}catch{return null}},setItem(e,t){try{localStorage.setItem(e,t)}catch(e){console.error("Failed to write to localStorage:",e)}},removeItem(e){try{localStorage.removeItem(e)}catch{}}}}let f=new class{db=null;initialized=!1;initPromise=null;kvStorage;constructor(e){this.kvStorage=e??d()}async initialize(){if(!this.initialized){if(this.initPromise)return this.initPromise;this.initPromise=this._initialize(),await this.initPromise,this.initialized=!0}}async _initialize(){return!function(){try{return!!window.indexedDB}catch{return!1}}()?void console.log("IndexedDB not available, using localStorage fallback"):new Promise(e=>{let t=indexedDB.open(a.DB_NAME,a.DB_VERSION);t.onerror=t=>{let a=t.target.error;console.error("Failed to open IndexedDB:",a),a&&c(a)&&l(a.message||"Database appears to be corrupted and cannot be opened."),e()},t.onsuccess=()=>{this.db=t.result,e()},t.onupgradeneeded=e=>{let t=e.target.result,r=e.target.transaction,n=e.oldVersion;if(r.onerror=e=>{let t=e.target.error;console.error("Database upgrade transaction error:",t),t&&c(t)&&l(t.message||"Database upgrade failed - database may be corrupted.")},r.onabort=e=>{let t=e.target.error;console.error("Database upgrade transaction aborted:",t),t&&c(t)&&l(t.message||"Database upgrade aborted - database may be corrupted.")},t.objectStoreNames.contains(a.CHARACTER_EDITOR_STORE_NAME)){if(n<2){let e=r.objectStore(a.CHARACTER_EDITOR_STORE_NAME);e.indexNames.contains("by-manufacturer")||e.createIndex("by-manufacturer","metadata.manufacturer",{unique:!1}),e.indexNames.contains("by-system")||e.createIndex("by-system","metadata.system",{unique:!1}),e.openCursor().onsuccess=e=>{let t=e.target.result;if(t){let e=t.value;e.metadata&&void 0===e.metadata.manufacturer&&(e.metadata.manufacturer=""),e.metadata&&void 0===e.metadata.system&&(e.metadata.system=""),t.update(e),t.continue()}}}if(n<3&&(r.objectStore(a.CHARACTER_EDITOR_STORE_NAME).openCursor().onsuccess=e=>{let t=e.target.result;if(t){let e=t.value;e.metadata&&void 0===e.metadata.isPinned&&(e.metadata.isPinned=!1),t.update(e),t.continue()}}),n<4){let e=r.objectStore(a.CHARACTER_EDITOR_STORE_NAME);e.indexNames.contains("by-locale")||e.createIndex("by-locale","metadata.locale",{unique:!1}),e.openCursor().onsuccess=e=>{let t=e.target.result;if(t){let e=t.value;e.metadata&&void 0===e.metadata.locale&&(e.metadata.locale=""),t.update(e),t.continue()}}}n<7&&(r.objectStore(a.CHARACTER_EDITOR_STORE_NAME).openCursor().onsuccess=e=>{let t=e.target.result;if(t){let e=t.value;e.metadata&&void 0===e.metadata.notes&&(e.metadata.notes=[]),t.update(e),t.continue()}}),n<8&&(r.objectStore(a.CHARACTER_EDITOR_STORE_NAME).openCursor().onsuccess=e=>{let t=e.target.result;if(t){let e=t.value;e.metadata&&void 0===e.metadata.origin&&(e.metadata.origin=e.metadata.isBuiltIn?"binary":"created"),t.update(e),t.continue()}}),n<9&&n>=8&&(r.objectStore(a.CHARACTER_EDITOR_STORE_NAME).openCursor().onsuccess=e=>{let t=e.target.result;if(t){let e=t.value;e.metadata&&"imported"===e.metadata.origin&&(e.metadata.origin="binary",t.update(e)),t.continue()}})}else{let e=t.createObjectStore(a.CHARACTER_EDITOR_STORE_NAME,{keyPath:"metadata.id"});e.createIndex("by-name","metadata.name",{unique:!1}),e.createIndex("by-updated","metadata.updatedAt",{unique:!1}),e.createIndex("by-size","sizeKey",{unique:!1}),e.createIndex("by-manufacturer","metadata.manufacturer",{unique:!1}),e.createIndex("by-system","metadata.system",{unique:!1}),e.createIndex("by-locale","metadata.locale",{unique:!1})}if(!t.objectStoreNames.contains(a.CHARACTER_EDITOR_SNAPSHOTS_STORE)){let e=t.createObjectStore(a.CHARACTER_EDITOR_SNAPSHOTS_STORE,{keyPath:"id"});e.createIndex("by-character-set","characterSetId",{unique:!1}),e.createIndex("by-created","createdAt",{unique:!1})}}})}useFallback(){return null===this.db}fallbackGetAll(){try{let e=this.kvStorage.getItem(a.CHARACTER_EDITOR_STORAGE_KEY_FALLBACK);if(!e)return[];return JSON.parse(e).map(e=>{let t=e.metadata.origin;return void 0===t?t=e.metadata.isBuiltIn?"binary":"created":"imported"===t&&(t="binary"),{...e,metadata:{...e.metadata,manufacturer:e.metadata.manufacturer??"",system:e.metadata.system??"",locale:e.metadata.locale??"",isPinned:e.metadata.isPinned??!1,notes:e.metadata.notes??[],origin:t}}})}catch{return[]}}fallbackSaveAll(e){try{this.kvStorage.setItem(a.CHARACTER_EDITOR_STORAGE_KEY_FALLBACK,JSON.stringify(e))}catch(e){throw console.error("Failed to save to fallback storage:",e),Error("Storage quota exceeded")}}async getAll(){return(await this.initialize(),this.useFallback())?this.fallbackGetAll():new Promise((e,t)=>{let r;try{r=this.db.transaction([a.CHARACTER_EDITOR_STORE_NAME],"readonly")}catch(e){c(e)&&l(e instanceof Error?e.message:"Failed to create transaction"),t(Error("Failed to access database"));return}let n=r.objectStore(a.CHARACTER_EDITOR_STORE_NAME).getAll();r.onerror=e=>{let t=e.target.error;t&&c(t)&&l(t.message||"Database read failed - database may be corrupted.")},n.onsuccess=()=>{let t=n.result;t.sort((e,t)=>{let a=+!!e.metadata.isPinned,r=+!!t.metadata.isPinned;return a!==r?r-a:t.metadata.updatedAt-e.metadata.updatedAt}),e(t)},n.onerror=e=>{let a=e.target.error;a&&c(a)&&l(a.message||"Failed to read character sets - database may be corrupted."),t(Error("Failed to get character sets"))}})}async getById(e){return(await this.initialize(),this.useFallback())?this.fallbackGetAll().find(t=>t.metadata.id===e)||null:new Promise((t,r)=>{let n=this.db.transaction([a.CHARACTER_EDITOR_STORE_NAME],"readonly").objectStore(a.CHARACTER_EDITOR_STORE_NAME).get(e);n.onsuccess=()=>{t(n.result||null)},n.onerror=()=>{r(Error("Failed to get character set"))}})}async save(e){await this.initialize();let t={...e,sizeKey:`${e.config.width}x${e.config.height}`};if(this.useFallback()){let t=this.fallbackGetAll(),a=t.findIndex(t=>t.metadata.id===e.metadata.id);return a>=0?t[a]=e:t.push(e),this.fallbackSaveAll(t),e.metadata.id}return new Promise((r,n)=>{let i=this.db.transaction([a.CHARACTER_EDITOR_STORE_NAME],"readwrite").objectStore(a.CHARACTER_EDITOR_STORE_NAME).put(t);i.onsuccess=()=>{r(e.metadata.id)},i.onerror=()=>{n(Error("Failed to save character set"))}})}async saveAs(e,a){let r=(0,t.generateId)(),n=Date.now(),i={...e,metadata:{...e.metadata,id:r,name:a,createdAt:n,updatedAt:n,isBuiltIn:!1,source:"yourself"}};return await this.save(i),r}async togglePinned(e){await this.initialize();let t=await this.getById(e);if(!t)throw Error("Character set not found");let a=!t.metadata.isPinned,r={...t,metadata:{...t.metadata,isPinned:a}};return await this.save(r),a}async addNote(e,a){await this.initialize();let r=await this.getById(e);if(!r)throw Error("Character set not found");let n=Date.now(),i={id:(0,t.generateId)(),text:a,createdAt:n,updatedAt:n},o={...r,metadata:{...r.metadata,notes:[...r.metadata.notes??[],i]}};return await this.save(o),i}async updateNote(e,t,a){await this.initialize();let r=await this.getById(e);if(!r)throw Error("Character set not found");let n=r.metadata.notes??[],i=n.findIndex(e=>e.id===t);if(-1===i)throw Error("Note not found");let o={...n[i],text:a,updatedAt:Date.now()},l=[...n];l[i]=o;let s={...r,metadata:{...r.metadata,notes:l}};return await this.save(s),o}async deleteNote(e,t){await this.initialize();let a=await this.getById(e);if(!a)throw Error("Character set not found");let r=(a.metadata.notes??[]).filter(e=>e.id!==t),n={...a,metadata:{...a.metadata,notes:r}};await this.save(n)}async getNotes(e){await this.initialize();let t=await this.getById(e);if(!t)throw Error("Character set not found");return t.metadata.notes??[]}async delete(e){if(await this.initialize(),this.useFallback()){let t=this.fallbackGetAll().filter(t=>t.metadata.id!==e);this.fallbackSaveAll(t);return}return new Promise((t,r)=>{let n=this.db.transaction([a.CHARACTER_EDITOR_STORE_NAME],"readwrite").objectStore(a.CHARACTER_EDITOR_STORE_NAME).delete(e);n.onsuccess=()=>{t()},n.onerror=()=>{r(Error("Failed to delete character set"))}})}async search(e){let t=await this.getAll(),a=e.toLowerCase();return t.filter(e=>e.metadata.name.toLowerCase().includes(a)||e.metadata.description.toLowerCase().includes(a)||e.metadata.source.toLowerCase().includes(a)||e.metadata.manufacturer.toLowerCase().includes(a)||e.metadata.system.toLowerCase().includes(a)||e.metadata.locale.toLowerCase().includes(a))}async filterBySize(e,t){return(await this.getAll()).filter(a=>(null===e||a.config.width===e)&&(null===t||a.config.height===t))}async filterByManufacturers(e){if(0===e.length)return this.getAll();let t=await this.getAll(),a=e.map(e=>e.toLowerCase());return t.filter(e=>a.includes(e.metadata.manufacturer.toLowerCase()))}async filterBySystems(e){if(0===e.length)return this.getAll();let t=await this.getAll(),a=e.map(e=>e.toLowerCase());return t.filter(e=>a.includes(e.metadata.system.toLowerCase()))}async getAvailableManufacturers(){let e=await this.getAll(),t=new Set;for(let a of e)a.metadata.manufacturer&&t.add(a.metadata.manufacturer);return Array.from(t).sort()}async getAvailableSystems(){let e=await this.getAll(),t=new Set;for(let a of e)a.metadata.system&&t.add(a.metadata.system);return Array.from(t).sort()}async getAvailableSizes(){let e=await this.getAll(),t=new Map;for(let a of e){let e=`${a.config.width}x${a.config.height}`;t.has(e)||t.set(e,{width:a.config.width,height:a.config.height})}return Array.from(t.values()).sort((e,t)=>e.width!==t.width?e.width-t.width:e.height-t.height)}async nameExists(e,t){return(await this.getAll()).some(a=>a.metadata.name.toLowerCase()===e.toLowerCase()&&a.metadata.id!==t)}async count(){return(await this.getAll()).length}async isEmpty(){return 0===(await this.getAll()).length}async clear(){return(await this.initialize(),this.useFallback())?void this.kvStorage.removeItem(a.CHARACTER_EDITOR_STORAGE_KEY_FALLBACK):new Promise((e,t)=>{let r=this.db.transaction([a.CHARACTER_EDITOR_STORE_NAME],"readwrite").objectStore(a.CHARACTER_EDITOR_STORE_NAME).clear();r.onsuccess=()=>{e()},r.onerror=()=>{t(Error("Failed to clear storage"))}})}};async function h(){await f.initialize();let e=f.db;return e&&!e.objectStoreNames.contains(a.CHARACTER_EDITOR_SNAPSHOTS_STORE)?(console.warn("Database missing snapshots store, triggering recreation..."),e.close(),await new Promise(e=>{let t=indexedDB.deleteDatabase(a.DB_NAME);t.onsuccess=()=>e(),t.onerror=()=>e(),t.onblocked=()=>e()}),f.db=null,f.initialized=!1,f.initPromise=null,await f.initialize(),f.db):e}e.s(["characterStorage",0,f,"createLocalStorageWrapper",()=>d,"getDatabaseCorruptionState",()=>o,"getSharedDatabase",()=>h,"onDatabaseCorruption",()=>i,"resetDatabase",()=>u],92832)},66811,e=>{"use strict";var t=e.i(71645),a=e.i(33712),r=e.i(92832),n=e.i(94136),i=e.i(28167);let o=[];function l(){return o.filter(e=>e.enabled)}let s=i.default;function c(e){let t=Date.now();return{metadata:{id:e.id,name:e.name,description:e.description||`${e.system} character set`,source:e.source||"RetroStack",manufacturer:e.manufacturer,system:e.system,chip:e.chip,locale:e.locale,createdAt:t,updatedAt:t,isBuiltIn:!0,builtInVersion:e.version,origin:"binary"},config:{width:e.width,height:e.height,padding:e.bitPadding??"right",bitDirection:e.bitDirection},binaryData:(0,n.binaryToBase64)(function(e){let t=new Uint8Array(e.reduce((e,t)=>e+t.length,0)),a=0;for(let r of e)for(let e of r)t[a++]=e;return t}(e.data))}}function u(e){let t=s.find(t=>t.id===e);return t?c(t):null}let d=new Map;async function f(e){if(d.has(e.url))return d.get(e.url)??null;try{let t=await fetch(e.url);if(!t.ok)return console.warn(`Failed to fetch external charsets from ${e.name}: ${t.status}`),d.set(e.url,null),null;let a=await t.json();if(!Array.isArray(a))return console.warn(`Invalid format from ${e.name}: expected array of character sets`),d.set(e.url,null),null;let r=a.filter(e=>"object"==typeof e&&null!==e&&"string"==typeof e.id&&"string"==typeof e.name&&"number"==typeof e.width&&"number"==typeof e.height&&Array.isArray(e.data));return d.set(e.url,r),r}catch(t){return console.warn(`Error fetching external charsets from ${e.name}:`,t),d.set(e.url,null),null}}async function h(){let e=l();if(0===e.length)return[];let t=await Promise.all(e.map(f)),a=[];for(let e of t)if(e)for(let t of e)a.push(t.id);return a}async function m(e){let t=l();if(0===t.length)return null;for(let a of(await Promise.all(t.map(f))))if(a){let t=a.find(t=>t.id===e);if(t)return c(t)}return null}function E(e){let i=(0,t.useMemo)(()=>e?.storage??r.characterStorage,[e?.storage]),[o,l]=(0,t.useState)([]),[c,d]=(0,t.useState)(!0),[f,E]=(0,t.useState)(null),[g,A]=(0,t.useState)([]),R=(0,t.useCallback)(async()=>{try{d(!0),E(null),await i.initialize();let e=await i.getAll(),t=new Map(e.map(e=>[e.metadata.id,e])),a=s.map(e=>e.id),r=[],n=[];for(let e of a){let a=t.get(e);if(a){let t=function(e){let t=s.find(t=>t.id===e);return t?.version??null}(e),r=a.metadata.builtInVersion??0;null!==t&&t>r&&n.push(e)}else r.push(e)}if(r.length>0)for(let e of r){let t=u(e);t&&await i.save(t)}if(n.length>0)for(let e of n){let a=t.get(e),r=u(e);r&&a&&(r.metadata.isPinned=a.metadata.isPinned,r.metadata.notes=a.metadata.notes,await i.save(r))}let o=!1;try{let e=(await h()).filter(e=>!t.has(e));if(e.length>0)for(let t of e){let e=await m(t);e&&(await i.save(e),o=!0)}}catch{}let c=r.length>0||n.length>0||o?await i.getAll():e;l(c);let f=await i.getAvailableSizes();A(f)}catch(e){E(e instanceof Error?e.message:"Failed to load library")}finally{d(!1)}},[i]);(0,t.useEffect)(()=>{R()},[R]);let y=(0,t.useCallback)(async()=>{await R()},[R]),w=(0,t.useCallback)(async e=>{try{let t=await i.getById(e);if(!t)return null;return(0,n.deserializeCharacterSet)(t)}catch(e){return console.error("Failed to get character set:",e),null}},[i]),b=(0,t.useCallback)(async e=>{try{let t=(0,n.serializeCharacterSet)(e),a=await i.save(t);return await y(),a}catch(e){throw Error(e instanceof Error?e.message:"Failed to save character set")}},[i,y]),C=(0,t.useCallback)(async(e,t)=>{try{let r={...e,metadata:{...e.metadata,id:(0,a.generateId)(),name:t,createdAt:Date.now(),updatedAt:Date.now(),isBuiltIn:!1,source:"yourself",origin:"copied",copiedFromId:e.metadata.id,copiedFromName:e.metadata.name}},o=(0,n.serializeCharacterSet)(r),l=await i.save(o);return await y(),l}catch(e){throw Error(e instanceof Error?e.message:"Failed to save character set")}},[i,y]),_=(0,t.useCallback)(async(e,t)=>{try{let a=await i.getById(e);if(!a)throw Error("Character set not found");let r={...a,metadata:{...a.metadata,name:t,updatedAt:Date.now()}};await i.save(r),await y()}catch(e){throw Error(e instanceof Error?e.message:"Failed to rename character set")}},[i,y]),p=(0,t.useCallback)(async(e,t)=>{try{let a=await i.getById(e);if(!a)throw Error("Character set not found");let r={...a,metadata:{...a.metadata,...t,updatedAt:Date.now()}};await i.save(r),await y()}catch(e){throw Error(e instanceof Error?e.message:"Failed to update metadata")}},[i,y]),T=(0,t.useCallback)(async e=>{try{await i.delete(e),await y()}catch(e){throw Error(e instanceof Error?e.message:"Failed to delete character set")}},[i,y]),S=(0,t.useCallback)(async e=>{try{await i.togglePinned(e),await y()}catch(e){throw Error(e instanceof Error?e.message:"Failed to toggle pinned state")}},[i,y]),O=(0,t.useCallback)(async e=>e.trim()?i.search(e):o,[i,o]),I=(0,t.useCallback)(async(e,t)=>null===e&&null===t?o:i.filterBySize(e,t),[i,o]);return{characterSets:o,loading:c,error:f,refresh:y,getById:w,save:b,saveAs:C,rename:_,updateMetadata:p,deleteSet:T,togglePinned:S,search:O,filterBySize:I,availableSizes:g,nameExists:(0,t.useCallback)(async(e,t)=>i.nameExists(e,t),[i])}}e.s(["useCharacterLibrary",()=>E],66811)},59544,e=>{"use strict";var t=e.i(43476),a=e.i(71645);let r={pink:"btn-neon btn-neon-pink",cyan:"btn-neon btn-neon-cyan",violet:"btn-neon btn-neon-violet",ghost:"bg-transparent text-retro-cyan hover:text-retro-pink transition-colors"},n={sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"},i=(0,a.forwardRef)(({className:e="",variant:a="pink",size:i="md",children:o,href:l,...s},c)=>{let u=`inline-flex items-center justify-center font-ui font-semibold uppercase tracking-wider rounded transition-all duration-300 ${r[a]} ${n[i]} ${e}`;return l?(0,t.jsx)("a",{href:l,className:u,children:o}):(0,t.jsx)("button",{ref:c,className:u,...s,children:o})});i.displayName="Button",e.s(["Button",0,i])}]);