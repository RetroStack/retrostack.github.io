(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,a)=>{t.exports=e.r(76562)},59544,e=>{"use strict";var t=e.i(43476),a=e.i(71645);let r={pink:"btn-neon btn-neon-pink",cyan:"btn-neon btn-neon-cyan",violet:"btn-neon btn-neon-violet",ghost:"bg-transparent text-retro-cyan hover:text-retro-pink transition-colors"},n={sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"},i=(0,a.forwardRef)(({className:e="",variant:a="pink",size:i="md",children:l,href:s,...o},c)=>{let u=`inline-flex items-center justify-center font-ui font-semibold uppercase tracking-wider rounded transition-all duration-300 ${r[a]} ${n[i]} ${e}`;return s?(0,t.jsx)("a",{href:s,className:u,children:l}):(0,t.jsx)("button",{ref:c,className:u,...o,children:l})});i.displayName="Button",e.s(["Button",0,i])},20446,e=>{"use strict";var t=e.i(43476),a=e.i(71645);function r({pixels:e,scale:r=1,showGrid:n=!1,gridColor:i="#333333",gridThickness:l=1,foregroundColor:s="#ffffff",backgroundColor:o="#000000",onPixelClick:c,onPixelDrag:u,onDragEnd:h,onPixelHover:d,onPixelLeave:f,className:p="",interactive:m=!0,mixedPixels:g,mixedColor:y="#666666"}){let E=(0,a.useRef)(null),[w,C]=(0,a.useState)(!1),b=(0,a.useRef)(null),S=e.length,A=e[0]?.length||0,R=n?l:0,x=A*r+(n?(A+1)*l:0),T=S*r+(n?(S+1)*l:0);(0,a.useEffect)(()=>{let t=E.current;if(!t)return;let a=t.getContext("2d");if(a){a.fillStyle=n?i:o,a.fillRect(0,0,x,T);for(let t=0;t<S;t++)for(let i=0;i<A;i++){let c=n?i*(r+l)+l:i*r,u=n?t*(r+l)+l:t*r,h=`${t},${i}`,d=g?.has(h),f=e[t]?.[i]||!1;if(d){let e=Math.floor(r/2);a.fillStyle=s,a.fillRect(c,u,e,e),a.fillRect(c+e,u+e,r-e,r-e),a.fillStyle=o,a.fillRect(c+e,u,r-e,e),a.fillRect(c,u+e,e,r-e)}else a.fillStyle=f?s:o,a.fillRect(c,u,r,r)}}},[e,r,n,i,l,s,o,x,T,A,S,g,y]);let k=(0,a.useCallback)(e=>{let t,a,i=E.current;if(!i)return null;let s=i.getBoundingClientRect();if("touches"in e){if(0===e.touches.length)return null;t=e.touches[0].clientX,a=e.touches[0].clientY}else t=e.clientX,a=e.clientY;let o=t-s.left,c=a-s.top,u=i.width/s.width,h=i.height/s.height,d=r+(n?l:0),f=Math.floor((o*u-R)/d),p=Math.floor((c*h-R)/d);return p>=0&&p<S&&f>=0&&f<A?{row:p,col:f}:null},[r,n,l,R,S,A]),v=(0,a.useCallback)(e=>{if(!m)return;2===e.button&&e.preventDefault();let t=k(e);t&&c&&(c(t.row,t.col,2===e.button),b.current=t,C(!0))},[m,k,c]),_=(0,a.useCallback)(e=>{m&&e.preventDefault()},[m]),O=(0,a.useCallback)(e=>{if(!m)return;let t=k(e);t&&d&&d(t.row,t.col),w&&u&&t&&(!b.current||b.current.row!==t.row||b.current.col!==t.col)&&(u(t.row,t.col),b.current=t)},[m,w,k,u,d]),D=(0,a.useCallback)(()=>{w&&(C(!1),b.current=null,h?.())},[w,h]),I=(0,a.useCallback)(()=>{w&&(C(!1),b.current=null,h?.()),f?.()},[w,h,f]),M=(0,a.useRef)(m),P=(0,a.useRef)(c),N=(0,a.useRef)(u),F=(0,a.useRef)(h),L=(0,a.useRef)(w);return(0,a.useEffect)(()=>{M.current=m},[m]),(0,a.useEffect)(()=>{P.current=c},[c]),(0,a.useEffect)(()=>{N.current=u},[u]),(0,a.useEffect)(()=>{F.current=h},[h]),(0,a.useEffect)(()=>{L.current=w},[w]),(0,a.useEffect)(()=>{let e=E.current;if(!e)return;let t=t=>{if(0===t.touches.length)return null;let a=e.getBoundingClientRect(),i=t.touches[0].clientX,s=t.touches[0].clientY,o=i-a.left,c=s-a.top,u=e.width/a.width,h=e.height/a.height,d=r+(n?l:0),f=Math.floor((o*u-R)/d),p=Math.floor((c*h-R)/d);return p>=0&&p<S&&f>=0&&f<A?{row:p,col:f}:null},a=e=>{if(!M.current)return;e.preventDefault();let a=t(e);a&&P.current&&(P.current(a.row,a.col),b.current=a,C(!0))},i=e=>{if(!M.current||!L.current||!N.current)return;e.preventDefault();let a=t(e);a&&(!b.current||b.current.row!==a.row||b.current.col!==a.col)&&(N.current(a.row,a.col),b.current=a)},s=()=>{L.current&&(C(!1),b.current=null,F.current?.())};return e.addEventListener("touchstart",a,{passive:!1}),e.addEventListener("touchmove",i,{passive:!1}),e.addEventListener("touchend",s),()=>{e.removeEventListener("touchstart",a),e.removeEventListener("touchmove",i),e.removeEventListener("touchend",s)}},[r,n,l,R,S,A]),(0,t.jsx)("canvas",{ref:E,width:x,height:T,className:`${m?"cursor-crosshair":""} ${p}`,style:{imageRendering:"pixelated",touchAction:"none"},onMouseDown:v,onMouseMove:O,onMouseUp:D,onMouseLeave:I,onContextMenu:_})}e.s(["PixelGrid",()=>r])},33712,e=>{"use strict";function t(e){return Math.ceil(e/8)}function a(e){return t(e.width)*e.height}function r(e){let t=e.binaryData,r=0;t.endsWith("==")?r=2:t.endsWith("=")&&(r=1);let n=3*t.length/4-r,i=a(e.config);return i>0?Math.floor(n/i):0}function n(e,t){let a=[];for(let r=0;r<t;r++)a.push(Array(e).fill(!1));return{pixels:a}}function i(e){return{pixels:e.pixels.map(e=>[...e])}}function l(){return{width:8,height:8,padding:"right",bitDirection:"ltr"}}function s(){return crypto.randomUUID()}e.s(["bytesPerCharacter",()=>a,"bytesPerLine",()=>t,"cloneCharacter",()=>i,"createDefaultConfig",()=>l,"createEmptyCharacter",()=>n,"generateId",()=>s,"getCharacterCount",()=>r])},60951,e=>{"use strict";e.s(["CHARACTER_EDITOR_SNAPSHOTS_STORE",0,"character-editor-snapshots","CHARACTER_EDITOR_STORAGE_KEY_AUTOSAVE",0,"retrostack-character-editor-autosave","CHARACTER_EDITOR_STORAGE_KEY_COLOR_PRESET",0,"retrostack-character-editor-color-preset","CHARACTER_EDITOR_STORAGE_KEY_CUSTOM_COLORS",0,"retrostack-character-editor-custom-colors","CHARACTER_EDITOR_STORAGE_KEY_FALLBACK",0,"retrostack-character-editor-sets","CHARACTER_EDITOR_STORAGE_KEY_ONBOARDING",0,"retrostack-character-editor-onboarding","CHARACTER_EDITOR_STORAGE_KEY_SORT_DIRECTION",0,"retrostack-character-editor-sort-direction","CHARACTER_EDITOR_STORAGE_KEY_SORT_FIELD",0,"retrostack-character-editor-sort-field","CHARACTER_EDITOR_STORE_NAME",0,"character-editor-sets","DB_NAME",0,"retrostack-web","DB_VERSION",0,6])},72670,e=>{"use strict";var t=e.i(33712),a=e.i(60951);let r=new class{db=null;initialized=!1;initPromise=null;async initialize(){if(!this.initialized){if(this.initPromise)return this.initPromise;this.initPromise=this._initialize(),await this.initPromise,this.initialized=!0}}async _initialize(){return!function(){try{return!!window.indexedDB}catch{return!1}}()?void console.log("IndexedDB not available, using localStorage fallback"):new Promise(e=>{let t=indexedDB.open(a.DB_NAME,a.DB_VERSION);t.onerror=()=>{console.error("Failed to open IndexedDB, using localStorage fallback"),e()},t.onsuccess=()=>{this.db=t.result,e()},t.onupgradeneeded=e=>{let t=e.target.result,r=e.target.transaction,n=e.oldVersion;if(t.objectStoreNames.contains(a.CHARACTER_EDITOR_STORE_NAME)){if(n<2){let e=r.objectStore(a.CHARACTER_EDITOR_STORE_NAME);e.indexNames.contains("by-manufacturer")||e.createIndex("by-manufacturer","metadata.manufacturer",{unique:!1}),e.indexNames.contains("by-system")||e.createIndex("by-system","metadata.system",{unique:!1}),e.openCursor().onsuccess=e=>{let t=e.target.result;if(t){let e=t.value;e.metadata&&void 0===e.metadata.manufacturer&&(e.metadata.manufacturer=""),e.metadata&&void 0===e.metadata.system&&(e.metadata.system=""),t.update(e),t.continue()}}}if(n<3&&(r.objectStore(a.CHARACTER_EDITOR_STORE_NAME).openCursor().onsuccess=e=>{let t=e.target.result;if(t){let e=t.value;e.metadata&&void 0===e.metadata.isPinned&&(e.metadata.isPinned=!1),t.update(e),t.continue()}}),n<4){let e=r.objectStore(a.CHARACTER_EDITOR_STORE_NAME);e.indexNames.contains("by-locale")||e.createIndex("by-locale","metadata.locale",{unique:!1}),e.openCursor().onsuccess=e=>{let t=e.target.result;if(t){let e=t.value;e.metadata&&void 0===e.metadata.locale&&(e.metadata.locale=""),t.update(e),t.continue()}}}}else{let e=t.createObjectStore(a.CHARACTER_EDITOR_STORE_NAME,{keyPath:"metadata.id"});e.createIndex("by-name","metadata.name",{unique:!1}),e.createIndex("by-updated","metadata.updatedAt",{unique:!1}),e.createIndex("by-size","sizeKey",{unique:!1}),e.createIndex("by-manufacturer","metadata.manufacturer",{unique:!1}),e.createIndex("by-system","metadata.system",{unique:!1}),e.createIndex("by-locale","metadata.locale",{unique:!1})}if(!t.objectStoreNames.contains(a.CHARACTER_EDITOR_SNAPSHOTS_STORE)){let e=t.createObjectStore(a.CHARACTER_EDITOR_SNAPSHOTS_STORE,{keyPath:"id"});e.createIndex("by-character-set","characterSetId",{unique:!1}),e.createIndex("by-created","createdAt",{unique:!1})}}})}useFallback(){return null===this.db}fallbackGetAll(){try{let e=localStorage.getItem(a.CHARACTER_EDITOR_STORAGE_KEY_FALLBACK);if(!e)return[];return JSON.parse(e).map(e=>({...e,metadata:{...e.metadata,manufacturer:e.metadata.manufacturer??"",system:e.metadata.system??"",locale:e.metadata.locale??"",isPinned:e.metadata.isPinned??!1}}))}catch{return[]}}fallbackSaveAll(e){try{localStorage.setItem(a.CHARACTER_EDITOR_STORAGE_KEY_FALLBACK,JSON.stringify(e))}catch(e){throw console.error("Failed to save to localStorage:",e),Error("Storage quota exceeded")}}async getAll(){return(await this.initialize(),this.useFallback())?this.fallbackGetAll():new Promise((e,t)=>{let r=this.db.transaction([a.CHARACTER_EDITOR_STORE_NAME],"readonly").objectStore(a.CHARACTER_EDITOR_STORE_NAME).getAll();r.onsuccess=()=>{let t=r.result;t.sort((e,t)=>{let a=+!!e.metadata.isPinned,r=+!!t.metadata.isPinned;return a!==r?r-a:t.metadata.updatedAt-e.metadata.updatedAt}),e(t)},r.onerror=()=>{t(Error("Failed to get character sets"))}})}async getById(e){return(await this.initialize(),this.useFallback())?this.fallbackGetAll().find(t=>t.metadata.id===e)||null:new Promise((t,r)=>{let n=this.db.transaction([a.CHARACTER_EDITOR_STORE_NAME],"readonly").objectStore(a.CHARACTER_EDITOR_STORE_NAME).get(e);n.onsuccess=()=>{t(n.result||null)},n.onerror=()=>{r(Error("Failed to get character set"))}})}async save(e){await this.initialize();let t={...e,sizeKey:`${e.config.width}x${e.config.height}`};if(this.useFallback()){let t=this.fallbackGetAll(),a=t.findIndex(t=>t.metadata.id===e.metadata.id);return a>=0?t[a]=e:t.push(e),this.fallbackSaveAll(t),e.metadata.id}return new Promise((r,n)=>{let i=this.db.transaction([a.CHARACTER_EDITOR_STORE_NAME],"readwrite").objectStore(a.CHARACTER_EDITOR_STORE_NAME).put(t);i.onsuccess=()=>{r(e.metadata.id)},i.onerror=()=>{n(Error("Failed to save character set"))}})}async saveAs(e,a){let r=(0,t.generateId)(),n=Date.now(),i={...e,metadata:{...e.metadata,id:r,name:a,createdAt:n,updatedAt:n,isBuiltIn:!1,source:"yourself"}};return await this.save(i),r}async togglePinned(e){await this.initialize();let t=await this.getById(e);if(!t)throw Error("Character set not found");let a=!t.metadata.isPinned,r={...t,metadata:{...t.metadata,isPinned:a}};return await this.save(r),a}async delete(e){if(await this.initialize(),this.useFallback()){let t=this.fallbackGetAll().filter(t=>t.metadata.id!==e);this.fallbackSaveAll(t);return}return new Promise((t,r)=>{let n=this.db.transaction([a.CHARACTER_EDITOR_STORE_NAME],"readwrite").objectStore(a.CHARACTER_EDITOR_STORE_NAME).delete(e);n.onsuccess=()=>{t()},n.onerror=()=>{r(Error("Failed to delete character set"))}})}async search(e){let t=await this.getAll(),a=e.toLowerCase();return t.filter(e=>e.metadata.name.toLowerCase().includes(a)||e.metadata.description.toLowerCase().includes(a)||e.metadata.source.toLowerCase().includes(a)||e.metadata.manufacturer.toLowerCase().includes(a)||e.metadata.system.toLowerCase().includes(a)||e.metadata.locale.toLowerCase().includes(a))}async filterBySize(e,t){return(await this.getAll()).filter(a=>(null===e||a.config.width===e)&&(null===t||a.config.height===t))}async filterByManufacturers(e){if(0===e.length)return this.getAll();let t=await this.getAll(),a=e.map(e=>e.toLowerCase());return t.filter(e=>a.includes(e.metadata.manufacturer.toLowerCase()))}async filterBySystems(e){if(0===e.length)return this.getAll();let t=await this.getAll(),a=e.map(e=>e.toLowerCase());return t.filter(e=>a.includes(e.metadata.system.toLowerCase()))}async getAvailableManufacturers(){let e=await this.getAll(),t=new Set;for(let a of e)a.metadata.manufacturer&&t.add(a.metadata.manufacturer);return Array.from(t).sort()}async getAvailableSystems(){let e=await this.getAll(),t=new Set;for(let a of e)a.metadata.system&&t.add(a.metadata.system);return Array.from(t).sort()}async getAvailableSizes(){let e=await this.getAll(),t=new Map;for(let a of e){let e=`${a.config.width}x${a.config.height}`;t.has(e)||t.set(e,{width:a.config.width,height:a.config.height})}return Array.from(t.values()).sort((e,t)=>e.width!==t.width?e.width-t.width:e.height-t.height)}async nameExists(e,t){return(await this.getAll()).some(a=>a.metadata.name.toLowerCase()===e.toLowerCase()&&a.metadata.id!==t)}async count(){return(await this.getAll()).length}async isEmpty(){return 0===(await this.getAll()).length}async clear(){return(await this.initialize(),this.useFallback())?void localStorage.removeItem(a.CHARACTER_EDITOR_STORAGE_KEY_FALLBACK):new Promise((e,t)=>{let r=this.db.transaction([a.CHARACTER_EDITOR_STORE_NAME],"readwrite").objectStore(a.CHARACTER_EDITOR_STORE_NAME).clear();r.onsuccess=()=>{e()},r.onerror=()=>{t(Error("Failed to clear storage"))}})}};async function n(){await r.initialize();let e=r.db;return e&&!e.objectStoreNames.contains(a.CHARACTER_EDITOR_SNAPSHOTS_STORE)?(console.warn("Database missing snapshots store, triggering recreation..."),e.close(),await new Promise(e=>{let t=indexedDB.deleteDatabase(a.DB_NAME);t.onsuccess=()=>e(),t.onerror=()=>e(),t.onblocked=()=>e()}),r.db=null,r.initialized=!1,r.initPromise=null,await r.initialize(),r.db):e}e.s(["characterStorage",0,r,"getSharedDatabase",()=>n])},94136,e=>{"use strict";var t=e.i(33712);function a(e,a){let{width:r,height:n,padding:i,bitDirection:l}=a,s=(0,t.bytesPerLine)(r),o=new Uint8Array(n*s);for(let t=0;t<n;t++){let a=8*s,n=a-r,c=Array(a).fill(!1);if("left"===i)for(let a=0;a<r;a++)c[n+a]=e.pixels[t]?.[a]||!1;else for(let a=0;a<r;a++)c[a]=e.pixels[t]?.[a]||!1;for(let e=0;e<s;e++){let a=0;for(let t=0;t<8;t++)c[8*e+t]&&(a|=1<<("ltr"===l?7-t:t));o[t*s+e]=a}}return o}function r(e,a){let r=e instanceof Uint8Array?e:new Uint8Array(e),n=(0,t.bytesPerCharacter)(a),i=Math.floor(r.length/n),l=[];for(let e=0;e<i;e++){let i=r.slice(e*n,(e+1)*n);l.push(function(e,a){let{width:r,height:n,padding:i,bitDirection:l}=a,s=(0,t.bytesPerLine)(r),o=[];for(let t=0;t<n;t++){let a=[],n=t*s,c=[];for(let t=0;t<s;t++){let a=e[n+t]||0;for(let e=0;e<8;e++){let t=(a&1<<("ltr"===l?7-e:e))!=0;c.push(t)}}let u=8*s,h=u-r;if("left"===i)for(let e=h;e<u;e++)a.push(c[e]);else for(let e=0;e<r;e++)a.push(c[e]);o.push(a)}return{pixels:o}}(i,a))}return l}function n(e,r){let n=(0,t.bytesPerCharacter)(r),i=new Uint8Array(e.length*n);for(let t=0;t<e.length;t++){let l=a(e[t],r);i.set(l,t*n)}return i}function i(e){let t="";for(let a=0;a<e.length;a++)t+=String.fromCharCode(e[a]);return btoa(t)}function l(e){let t=atob(e),a=new Uint8Array(t.length);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);return a}function s(e){let t=n(e.characters,e.config);return{metadata:e.metadata,config:e.config,binaryData:i(t)}}function o(e){let t=r(l(e.binaryData),e.config);return{metadata:e.metadata,config:e.config,characters:t}}function c(e,t,a){return new Blob([n(e,{...t,...a}).buffer],{type:"application/octet-stream"})}function u(e,t){let a=URL.createObjectURL(e),r=document.createElement("a");r.href=a,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)}e.s(["base64ToBinary",()=>l,"binaryToBase64",()=>i,"characterToBytes",()=>a,"createDownloadBlob",()=>c,"deserializeCharacterSet",()=>o,"downloadBlob",()=>u,"parseCharacterRom",()=>r,"serializeCharacterRom",()=>n,"serializeCharacterSet",()=>s])},66811,e=>{"use strict";var t=e.i(71645),a=e.i(33712),r=e.i(72670),n=e.i(94136),i=e.i(28167);let l=[];function s(){return l.filter(e=>e.enabled)}let o=i.default;function c(e){let t=Date.now();return{metadata:{id:e.id,name:e.name,description:e.description||`${e.system} character set`,source:e.source||"RetroStack",manufacturer:e.manufacturer,system:e.system,chip:e.chip,locale:e.locale,createdAt:t,updatedAt:t,isBuiltIn:!0},config:{width:e.width,height:e.height,padding:e.bitPadding??"right",bitDirection:e.bitDirection},binaryData:(0,n.binaryToBase64)(function(e){let t=new Uint8Array(e.reduce((e,t)=>e+t.length,0)),a=0;for(let r of e)for(let e of r)t[a++]=e;return t}(e.data))}}let u=new Map;async function h(e){if(u.has(e.url))return u.get(e.url)??null;try{let t=await fetch(e.url);if(!t.ok)return console.warn(`Failed to fetch external charsets from ${e.name}: ${t.status}`),u.set(e.url,null),null;let a=await t.json();if(!Array.isArray(a))return console.warn(`Invalid format from ${e.name}: expected array of character sets`),u.set(e.url,null),null;let r=a.filter(e=>"object"==typeof e&&null!==e&&"string"==typeof e.id&&"string"==typeof e.name&&"number"==typeof e.width&&"number"==typeof e.height&&Array.isArray(e.data));return u.set(e.url,r),r}catch(t){return console.warn(`Error fetching external charsets from ${e.name}:`,t),u.set(e.url,null),null}}async function d(){let e=s();if(0===e.length)return[];let t=await Promise.all(e.map(h)),a=[];for(let e of t)if(e)for(let t of e)a.push(t.id);return a}async function f(e){let t=s();if(0===t.length)return null;for(let a of(await Promise.all(t.map(h))))if(a){let t=a.find(t=>t.id===e);if(t)return c(t)}return null}function p(){let[e,i]=(0,t.useState)([]),[l,s]=(0,t.useState)(!0),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)([]),g=(0,t.useCallback)(async()=>{try{s(!0),h(null),await r.characterStorage.initialize();let e=await r.characterStorage.getAll(),t=new Set(e.map(e=>e.metadata.id)),a=o.map(e=>e.id).filter(e=>!t.has(e));if(a.length>0)for(let e of a){let t=function(e){let t=o.find(t=>t.id===e);return t?c(t):null}(e);t&&await r.characterStorage.save(t)}let n=(await d()).filter(e=>!t.has(e));if(n.length>0)for(let e of n){let t=await f(e);t&&await r.characterStorage.save(t)}let l=a.length>0||n.length>0?await r.characterStorage.getAll():e;i(l);let u=await r.characterStorage.getAvailableSizes();m(u)}catch(e){h(e instanceof Error?e.message:"Failed to load library")}finally{s(!1)}},[]);(0,t.useEffect)(()=>{g()},[g]);let y=(0,t.useCallback)(async()=>{await g()},[g]),E=(0,t.useCallback)(async e=>{try{let t=await r.characterStorage.getById(e);if(!t)return null;return(0,n.deserializeCharacterSet)(t)}catch(e){return console.error("Failed to get character set:",e),null}},[]),w=(0,t.useCallback)(async e=>{try{let t=(0,n.serializeCharacterSet)(e),a=await r.characterStorage.save(t);return await y(),a}catch(e){throw Error(e instanceof Error?e.message:"Failed to save character set")}},[y]),C=(0,t.useCallback)(async(e,t)=>{try{let i={...e,metadata:{...e.metadata,id:(0,a.generateId)(),name:t,createdAt:Date.now(),updatedAt:Date.now(),isBuiltIn:!1,source:"yourself"}},l=(0,n.serializeCharacterSet)(i),s=await r.characterStorage.save(l);return await y(),s}catch(e){throw Error(e instanceof Error?e.message:"Failed to save character set")}},[y]),b=(0,t.useCallback)(async(e,t)=>{try{let a=await r.characterStorage.getById(e);if(!a)throw Error("Character set not found");let n={...a,metadata:{...a.metadata,name:t,updatedAt:Date.now()}};await r.characterStorage.save(n),await y()}catch(e){throw Error(e instanceof Error?e.message:"Failed to rename character set")}},[y]),S=(0,t.useCallback)(async(e,t)=>{try{let a=await r.characterStorage.getById(e);if(!a)throw Error("Character set not found");let n={...a,metadata:{...a.metadata,...t,updatedAt:Date.now()}};await r.characterStorage.save(n),await y()}catch(e){throw Error(e instanceof Error?e.message:"Failed to update metadata")}},[y]),A=(0,t.useCallback)(async e=>{try{await r.characterStorage.delete(e),await y()}catch(e){throw Error(e instanceof Error?e.message:"Failed to delete character set")}},[y]),R=(0,t.useCallback)(async e=>{try{await r.characterStorage.togglePinned(e),await y()}catch(e){throw Error(e instanceof Error?e.message:"Failed to toggle pinned state")}},[y]),x=(0,t.useCallback)(async t=>t.trim()?r.characterStorage.search(t):e,[e]),T=(0,t.useCallback)(async(t,a)=>null===t&&null===a?e:r.characterStorage.filterBySize(t,a),[e]);return{characterSets:e,loading:l,error:u,refresh:y,getById:E,save:w,saveAs:C,rename:b,updateMetadata:S,deleteSet:A,togglePinned:R,search:x,filterBySize:T,availableSizes:p,nameExists:(0,t.useCallback)(async(e,t)=>r.characterStorage.nameExists(e,t),[])}}e.s(["useCharacterLibrary",()=>p],66811)},20371,e=>{"use strict";var t=e.i(33712);function a(e,t){let a=e.pixels.length,r=e.pixels[0]?.length||0,n=[];for(let i=0;i<a;i++){let l=[];for(let n=0;n<r;n++){let s,o;"right"===t?(s=r-1-n,o=i):(s=n,o=a-1-i),s>=0&&s<a&&o>=0&&o<r?l.push(e.pixels[s]?.[o]||!1):l.push(!1)}n.push(l)}return{pixels:n}}function r(e,t,a=!0){let n=e.pixels.length,i=e.pixels[0]?.length||0,l=[];for(let r=0;r<n;r++){let s=[];for(let l=0;l<i;l++){let o=r,c=l;switch(t){case"up":if((o=r+1)>=n&&(o=a?0:n-1,!a)){s.push(!1);continue}break;case"down":if((o=r-1)<0&&(o=a?n-1:0,!a)){s.push(!1);continue}break;case"left":if((c=l+1)>=i&&(c=a?0:i-1,!a)){s.push(!1);continue}break;case"right":if((c=l-1)<0&&(c=a?i-1:0,!a)){s.push(!1);continue}}s.push(e.pixels[o]?.[c]||!1)}l.push(s)}return{pixels:l}}function n(e,t,a,r){let n=e.pixels.length,i=e.pixels[0]?.length||0,l=0,s=0;r.endsWith("l")?l=0:r.endsWith("c")?l=Math.floor((t-i)/2):r.endsWith("r")&&(l=t-i),r.startsWith("t")?s=0:r.startsWith("m")?s=Math.floor((a-n)/2):r.startsWith("b")&&(s=a-n);let o=[];for(let r=0;r<a;r++){let a=[];for(let o=0;o<t;o++){let t=r-s,c=o-l;t>=0&&t<n&&c>=0&&c<i?a.push(e.pixels[t][c]):a.push(!1)}o.push(a)}return{pixels:o}}function i(e){return{pixels:e.pixels.map(e=>e.map(e=>!e))}}function l(e){return{pixels:e.pixels.map(e=>[...e].reverse())}}function s(e){return{pixels:[...e.pixels].reverse().map(e=>[...e])}}function o(e,a){return(0,t.createEmptyCharacter)(e,a)}function c(e,t){let a=[];for(let r=0;r<t;r++)a.push(Array(e).fill(!0));return{pixels:a}}function u(e,t,a){return{pixels:e.pixels.map((e,r)=>r===t?e.map((e,t)=>t===a?!e:e):[...e])}}function h(e,t,a,r){return{pixels:e.pixels.map((e,n)=>n===t?e.map((e,t)=>t===a?r:e):[...e])}}function d(e,t,a){return e.map((e,r)=>t.has(r)?a(e):e)}function f(e,t,a,r){let n=Array.from(t).map(t=>e[t]);if(0===n.length)return"same-off";let i=n[0]?.pixels[a]?.[r]||!1;for(let e=1;e<n.length;e++)if((n[e]?.pixels[a]?.[r]||!1)!==i)return"mixed";return i?"same-on":"same-off"}function p(e,t,a,r){let n="same-on"!==f(e,t,a,r);return e.map((e,i)=>t.has(i)?h(e,a,r,n):e)}function m(e){let t=e.pixels.length,a=e.pixels[0]?.length||0,r=function(e){let t=e.pixels.length,a=e.pixels[0]?.length||0,r=t,n=-1,i=a,l=-1;for(let s=0;s<t;s++)for(let t=0;t<a;t++)e.pixels[s][t]&&(r=Math.min(r,s),n=Math.max(n,s),i=Math.min(i,t),l=Math.max(l,t));return -1===n?null:{minRow:r,maxRow:n,minCol:i,maxCol:l}}(e);if(!r)return e;let n=r.maxCol-r.minCol+1,i=Math.floor((t-(r.maxRow-r.minRow+1))/2),l=Math.floor((a-n)/2)-r.minCol,s=i-r.minRow;if(0===l&&0===s)return e;let o=[];for(let r=0;r<t;r++){let n=[];for(let i=0;i<a;i++){let o=r-s,c=i-l;o>=0&&o<t&&c>=0&&c<a?n.push(e.pixels[o][c]):n.push(!1)}o.push(n)}return{pixels:o}}function g(e,t,a,r){return 1===t?e:"nearest"===r?function(e,t,a){let r=e.pixels.length,n=e.pixels[0]?.length||0,i=Math.round(n*t),l=Math.round(r*t),s=[];for(let a=0;a<l;a++){let l=[];for(let s=0;s<i;s++){let i=Math.min(Math.floor(a/t),r-1),o=Math.min(Math.floor(s/t),n-1);l.push(e.pixels[i]?.[o]||!1)}s.push(l)}let o=n-i,c=r-l,u=0,h=0;a.endsWith("l")?u=0:a.endsWith("c")?u=Math.floor(o/2):a.endsWith("r")&&(u=o),a.startsWith("t")?h=0:a.startsWith("m")?h=Math.floor(c/2):a.startsWith("b")&&(h=c);let d=[];for(let e=0;e<r;e++){let t=[];for(let a=0;a<n;a++){let r=e-h,n=a-u;r>=0&&r<l&&n>=0&&n<i?t.push(s[r][n]):t.push(!1)}d.push(t)}return{pixels:d}}(e,t,a):function(e,t,a,r=.5){let n=e.pixels.length,i=e.pixels[0]?.length||0,l=Math.round(i*t),s=Math.round(n*t),o=[];for(let a=0;a<s;a++){let n=[];for(let i=0;i<l;i++){let l=a/t,s=(a+1)/t,o=i/t,c=(i+1)/t,u=function(e,t,a,r,n){let i=e.length,l=e[0]?.length||0,s=0,o=0,c=Math.max(0,Math.floor(t)),u=Math.min(i-1,Math.floor(a)),h=Math.max(0,Math.floor(r)),d=Math.min(l-1,Math.floor(n));for(let i=c;i<=u;i++)for(let l=h;l<=d;l++){let c=Math.max(i,t),u=Math.max(l,r),h=(Math.min(i+1,a)-c)*(Math.min(l+1,n)-u);s+=h,e[i][l]&&(o+=h)}return 0===s?0:o/s}(e.pixels,l,s,o,c);n.push(u>=r)}o.push(n)}let c=i-l,u=n-s,h=0,d=0;a.endsWith("l")?h=0:a.endsWith("c")?h=Math.floor(c/2):a.endsWith("r")&&(h=c),a.startsWith("t")?d=0:a.startsWith("m")?d=Math.floor(u/2):a.startsWith("b")&&(d=u);let f=[];for(let e=0;e<n;e++){let t=[];for(let a=0;a<i;a++){let r=e-d,n=a-h;r>=0&&r<s&&n>=0&&n<l?t.push(o[r][n]):t.push(!1)}f.push(t)}return{pixels:f}}(e,t,a)}e.s(["batchTogglePixel",()=>p,"batchTransform",()=>d,"centerCharacter",()=>m,"clearCharacter",()=>o,"fillCharacter",()=>c,"flipHorizontal",()=>l,"flipVertical",()=>s,"getPixelState",()=>f,"invertCharacter",()=>i,"resizeCharacter",()=>n,"rotateCharacter",()=>a,"scaleCharacter",()=>g,"setPixel",()=>h,"shiftCharacter",()=>r,"togglePixel",()=>u])},83621,16227,e=>{"use strict";var t=e.i(71645),a=e.i(33712),r=e.i(20371);function n(e,a=1/0){let[r,i]=(0,t.useState)(()=>({past:[],present:{state:e,label:"Initial state",timestamp:Date.now()},future:[]})),l=(0,t.useRef)(!1),s=(0,t.useRef)(null),o=(0,t.useCallback)((e,t)=>{l.current?i(a=>({...a,present:{state:e,label:t,timestamp:Date.now()}})):i(r=>{let n=[...r.past,r.present];return n.length>a&&(n=n.slice(-a)),{past:n,present:{state:e,label:t,timestamp:Date.now()},future:[]}})},[a]),c=(0,t.useCallback)(()=>{l.current||(s.current=r.present,l.current=!0)},[r.present]),u=(0,t.useCallback)(e=>{if(!l.current||!s.current){s.current=null,l.current=!1;return}let t=s.current;s.current=null,l.current=!1,i(r=>{if(JSON.stringify(t.state)!==JSON.stringify(r.present.state)){let n=[...r.past,t];return n.length>a&&(n=n.slice(-a)),{past:n,present:{...r.present,label:e||r.present.label},future:[]}}return r})},[a]),h=(0,t.useCallback)(e=>{i({past:[],present:{state:e,label:"Initial state",timestamp:Date.now()},future:[]})},[]),d=(0,t.useCallback)(()=>{i(e=>{if(0===e.past.length)return e;let t=e.past[e.past.length-1];return{past:e.past.slice(0,-1),present:t,future:[e.present,...e.future]}})},[]),f=(0,t.useCallback)(()=>{i(e=>{if(0===e.future.length)return e;let t=e.future[0],a=e.future.slice(1);return{past:[...e.past,e.present],present:t,future:a}})},[]),p=(0,t.useCallback)(()=>{i(e=>({...e,past:[],future:[]}))},[]),m=(0,t.useCallback)(e=>{i(t=>{let a=Math.max(0,Math.min(e,t.past.length+1+t.future.length-1));if(a===t.past.length)return t;let r=[...t.past,t.present,...t.future],n=r[a];return n?{past:r.slice(0,a),present:n,future:r.slice(a+1)}:t})},[]),{past:g,present:y,future:E}=r,w=(0,t.useMemo)(()=>[...g,y,...E],[g,y,E]),C=g.length+1+E.length,b=g.length;return{state:y.state,setState:o,resetState:h,undo:d,redo:f,canUndo:g.length>0,canRedo:E.length>0,historyLength:g.length+E.length,clearHistory:p,history:w,historyIndex:b,jumpToHistory:m,totalHistoryEntries:C,startBatch:c,endBatch:u,isBatching:l.current}}function i(e){return JSON.parse(JSON.stringify(e))}function l(e){let{state:l,setState:s,resetState:o,undo:c,redo:u,canUndo:h,canRedo:d,history:f,historyIndex:p,jumpToHistory:m,totalHistoryEntries:g,startBatch:y,endBatch:E}=n(e?{characters:e.characters.map(a.cloneCharacter),config:{...e.config}}:{characters:[],config:{width:8,height:8,padding:"right",bitDirection:"ltr"}}),[w,C]=(0,t.useState)(0),[b,S]=(0,t.useState)(new Set),[A,R]=(0,t.useState)(!1),[,x]=(0,t.useState)(null),T=(0,t.useMemo)(()=>{let e=new Set(b);return e.add(w),e},[w,b]),k=(0,t.useCallback)((e,t)=>{s(e(i(l)),t),R(!0)},[l,s]),[v,_]=(0,t.useState)(null),O=(0,t.useCallback)((e,t,a=!1)=>{if(a)S(t=>{let a=new Set(t);if(e===w){if(a.size>0){let[e]=a;a.delete(e),a.add(w),C(e)}}else a.has(e)?a.delete(e):a.add(e);return a});else if(t){let t=v??w,a=Math.min(t,e),r=Math.max(t,e),n=new Set;for(let e=a;e<=r;e++)n.add(e);C(e),n.delete(e),S(n)}else C(e),_(e),S(new Set)},[w,v]),D=(0,t.useCallback)(()=>{S(new Set)},[]),I=(0,t.useCallback)(()=>{S(new Set(Array.from({length:l.characters.length},(e,t)=>t)))},[l.characters.length]),M=(0,t.useCallback)((e,t)=>{k(a=>{if(T.size>1)a.characters=(0,r.batchTogglePixel)(a.characters,T,e,t);else{let n=a.characters[w];n&&(a.characters[w]=(0,r.togglePixel)(n,e,t))}return a})},[k,w,T]),P=(0,t.useCallback)((e,t,a)=>{k(n=>{for(let i of T){let l=n.characters[i];l&&(n.characters[i]=(0,r.setPixel)(l,e,t,a))}return n})},[k,T]),N=(0,t.useCallback)((e,t)=>(0,r.getPixelState)(l.characters,T,e,t),[l.characters,T]),F=(0,t.useCallback)(e=>{k(t=>(t.characters=(0,r.batchTransform)(t.characters,T,t=>(0,r.rotateCharacter)(t,e)),t))},[k,T]),L=(0,t.useCallback)((e,t=!0)=>{k(a=>(a.characters=(0,r.batchTransform)(a.characters,T,a=>(0,r.shiftCharacter)(a,e,t)),a))},[k,T]),B=(0,t.useCallback)(()=>{k(e=>(e.characters=(0,r.batchTransform)(e.characters,T,r.invertCharacter),e))},[k,T]),H=(0,t.useCallback)(()=>{k(e=>(e.characters=(0,r.batchTransform)(e.characters,T,r.flipHorizontal),e))},[k,T]),z=(0,t.useCallback)(()=>{k(e=>(e.characters=(0,r.batchTransform)(e.characters,T,r.flipVertical),e))},[k,T]),U=(0,t.useCallback)(()=>{k(e=>{let{width:t,height:n}=e.config;return e.characters=(0,r.batchTransform)(e.characters,T,()=>(0,a.createEmptyCharacter)(t,n)),e})},[k,T]),j=(0,t.useCallback)(()=>{k(e=>{let{width:t,height:a}=e.config;return e.characters=(0,r.batchTransform)(e.characters,T,()=>({pixels:Array.from({length:a},()=>Array(t).fill(!0))})),e})},[k,T]),K=(0,t.useCallback)(()=>{console.log("centerSelected called",{selectedIndices:Array.from(T)}),k(e=>{console.log("updateState updater called",{numCharacters:e.characters.length});let t=e.characters.map(e=>e.pixels.flat().filter(Boolean).length);return e.characters=(0,r.batchTransform)(e.characters,T,r.centerCharacter),console.log("After batchTransform",{before:t,after:e.characters.map(e=>e.pixels.flat().filter(Boolean).length)}),e})},[k,T]),G=(0,t.useCallback)((e,t,a)=>{k(n=>(n.characters=(0,r.batchTransform)(n.characters,T,n=>(0,r.scaleCharacter)(n,e,t,a)),n))},[k,T]),W=(0,t.useCallback)(()=>{k(e=>{let{width:t,height:r}=e.config;return e.characters=[...e.characters,(0,a.createEmptyCharacter)(t,r)],e}),C(l.characters.length),S(new Set)},[k,l.characters.length]),Y=(0,t.useCallback)(e=>{0!==e.length&&(k(t=>(t.characters=[...t.characters,...e.map(e=>(0,a.cloneCharacter)(e))],t)),C(l.characters.length),S(new Set))},[k,l.characters.length]),$=(0,t.useCallback)(()=>{l.characters.length<=1||(k(e=>(e.characters=e.characters.filter((e,t)=>!T.has(t)),e)),C(Math.min(w,l.characters.length-T.size-1)),S(new Set))},[k,T,l.characters.length,w]),V=(0,t.useCallback)((e,t)=>{k(r=>{let n=r.characters[e];return n&&t>=0&&t<r.characters.length&&(r.characters[t]=(0,a.cloneCharacter)(n)),r})},[k]),q=(0,t.useCallback)((e,t,a)=>{k(n=>(n.characters=n.characters.map(n=>(0,r.resizeCharacter)(n,e,t,a)),n.config={...n.config,width:e,height:t},n))},[k]),J=(0,t.useCallback)((e,t)=>{k(r=>(e>=0&&e<r.characters.length&&(r.characters[e]=(0,a.cloneCharacter)(t)),r))},[k]),X=(0,t.useCallback)(e=>{k(t=>(t.characters=e.map(a.cloneCharacter),t))},[k]),Q=(0,t.useCallback)(()=>{R(!1),x(i(l))},[l]),Z=(0,t.useCallback)(e=>{o({characters:e.characters.map(a.cloneCharacter),config:{...e.config}}),C(0),_(null),S(new Set),R(!1),x(null)},[o]);return{characters:l.characters,config:l.config,selectedIndex:w,setSelectedIndex:C,batchSelection:b,toggleBatchSelection:O,clearBatchSelection:D,selectAll:I,toggleSelectedPixel:M,setSelectedPixel:P,getSelectedPixelState:N,rotateSelected:F,shiftSelected:L,invertSelected:B,flipSelectedHorizontal:H,flipSelectedVertical:z,clearSelected:U,fillSelected:j,centerSelected:K,scaleSelected:G,selectedIndices:T,addCharacter:W,addCharacters:Y,deleteSelected:$,copyCharacter:V,resizeCharacters:q,updateCharacter:J,setCharacters:X,undo:c,redo:u,canUndo:h,canRedo:d,isDirty:A,markSaved:Q,reset:Z,history:f,historyIndex:p,jumpToHistory:m,totalHistoryEntries:g,startBatch:y,endBatch:E}}e.s(["deepClone",()=>i,"useUndoRedo",()=>n],16227),e.s(["useCharacterEditor",()=>l],83621)},3573,e=>{"use strict";var t=e.i(71645);function a(e,r={}){let{enabled:n=!0,target:i=null}=r,l=(0,t.useRef)(e);(0,t.useEffect)(()=>{l.current=e},[e]);let s=(0,t.useCallback)(e=>{let t=e.target?.tagName?.toLowerCase();if("input"!==t&&"textarea"!==t&&"select"!==t||e.ctrlKey||e.metaKey)for(let t of l.current){let a=e.key.toLowerCase()===t.key.toLowerCase(),r=!!t.ctrl===(e.ctrlKey||e.metaKey),n=!!t.shift===e.shiftKey,i=!!t.alt===e.altKey;if(a&&r&&n&&i){e.preventDefault(),t.action();return}}},[]);(0,t.useEffect)(()=>{if(!n)return;let e=i||window;return e.addEventListener("keydown",s),()=>{e.removeEventListener("keydown",s)}},[n,i,s])}function r(e){let t=[],a="undefined"!=typeof navigator&&/Mac/.test(navigator.platform);e.ctrl&&t.push(a?"⌘":"Ctrl"),e.alt&&t.push(a?"⌥":"Alt"),e.shift&&t.push(a?"⇧":"Shift");let r=e.key;return t.push(r=" "===r?"Space":"ArrowUp"===r?"↑":"ArrowDown"===r?"↓":"ArrowLeft"===r?"←":"ArrowRight"===r?"→":"Escape"===r?"Esc":"Delete"===r?"Del":"Backspace"===r?"⌫":r.toUpperCase()),t.join(a?"":"+")}function n(e){return[{key:"z",ctrl:!0,action:e.undo,description:"Undo",context:"Editor"},{key:"z",ctrl:!0,shift:!0,action:e.redo,description:"Redo",context:"Editor"},{key:"y",ctrl:!0,action:e.redo,description:"Redo",context:"Editor"},{key:"s",ctrl:!0,action:e.save,description:"Save",context:"Editor"},{key:"r",action:e.rotateRight,description:"Rotate right",context:"Editor"},{key:"r",shift:!0,action:e.rotateLeft,description:"Rotate left",context:"Editor"},{key:"w",action:e.shiftUp,description:"Shift up",context:"Editor"},{key:"s",action:e.shiftDown,description:"Shift down",context:"Editor"},{key:"a",action:e.shiftLeft,description:"Shift left",context:"Editor"},{key:"d",action:e.shiftRight,description:"Shift right",context:"Editor"},{key:"i",action:e.invert,description:"Invert colors",context:"Editor"},{key:"h",action:e.flipHorizontal,description:"Flip horizontal",context:"Editor"},{key:"v",action:e.flipVertical,description:"Flip vertical",context:"Editor"},{key:"a",ctrl:!0,action:e.selectAll,description:"Select all",context:"Sidebar"},{key:"Delete",action:e.deleteSelected,description:"Delete selected",context:"Sidebar"},{key:"Backspace",action:e.deleteSelected,description:"Delete selected",context:"Sidebar"},{key:"n",ctrl:!0,action:e.addCharacter,description:"Add new character",context:"Editor"},{key:"?",action:e.showHelp,description:"Show keyboard shortcuts",context:"Global"},...e.navigatePrev?[{key:"ArrowUp",action:e.navigatePrev,description:"Previous character",context:"Navigation"}]:[],...e.navigateNext?[{key:"ArrowDown",action:e.navigateNext,description:"Next character",context:"Navigation"}]:[],...e.navigatePageUp?[{key:"PageUp",action:e.navigatePageUp,description:"Jump 16 characters up",context:"Navigation"}]:[],...e.navigatePageDown?[{key:"PageDown",action:e.navigatePageDown,description:"Jump 16 characters down",context:"Navigation"}]:[],...e.navigateFirst?[{key:"Home",action:e.navigateFirst,description:"First character",context:"Navigation"}]:[],...e.navigateLast?[{key:"End",action:e.navigateLast,description:"Last character",context:"Navigation"}]:[],...e.goToCharacter?[{key:"g",action:e.goToCharacter,description:"Go to character",context:"Navigation"}]:[],...e.showAsciiMap?[{key:"m",action:e.showAsciiMap,description:"Show ASCII map",context:"Navigation"}]:[],...e.showTextPreview?[{key:"t",action:e.showTextPreview,description:"Text preview",context:"View"}]:[],...e.showSnapshots?[{key:"s",ctrl:!0,shift:!0,action:e.showSnapshots,description:"Snapshots",context:"Editor"}]:[],...e.exportSet?[{key:"e",action:e.exportSet,description:"Export character set",context:"File"}]:[],...e.importSet?[{key:"i",ctrl:!0,action:e.importSet,description:"Import characters",context:"File"}]:[],...e.shareSet?[{key:"e",ctrl:!0,shift:!0,action:e.shareSet,description:"Share character set",context:"File"}]:[],...e.saveAs?[{key:"s",ctrl:!0,alt:!0,action:e.saveAs,description:"Save as new",context:"File"}]:[],...e.editMetadata?[{key:"F2",action:e.editMetadata,description:"Edit info",context:"File"}]:[],...e.resetChanges?[{key:"r",ctrl:!0,shift:!0,action:e.resetChanges,description:"Reset changes",context:"Editor"}]:[],...e.reorderCharacters?[{key:"o",action:e.reorderCharacters,description:"Reorder characters",context:"Editor"}]:[]]}e.s(["createEditorShortcuts",()=>n,"formatShortcut",()=>r,"useKeyboardShortcuts",()=>a])},7259,54750,69771,e=>{"use strict";e.i(66811),e.i(83621),e.i(16227),e.i(3573);var t=e.i(71645),a=e.i(94136),r=e.i(60951);function n(e){let{characterSetId:n,characters:i,config:l,selectedIndex:s,isDirty:o,enabled:c=!0}=e,[u,h]=(0,t.useState)(null),d=(0,t.useRef)(0),f=(0,t.useRef)(null);(0,t.useEffect)(()=>{if(n)try{let e=localStorage.getItem(r.CHARACTER_EDITOR_STORAGE_KEY_AUTOSAVE);if(e){let t=JSON.parse(e);t.characterSetId===n&&t.isDirty&&h(t)}}catch{}},[n]);let p=(0,t.useCallback)(()=>{if(n&&c&&0!==i.length)try{let e=(0,a.binaryToBase64)((0,a.serializeCharacterRom)(i,l)),t={characterSetId:n,binaryData:e,config:l,selectedIndex:s,timestamp:Date.now(),isDirty:o};localStorage.setItem(r.CHARACTER_EDITOR_STORAGE_KEY_AUTOSAVE,JSON.stringify(t)),d.current=Date.now()}catch(e){console.error("Auto-save failed:",e)}},[n,i,l,s,o,c]);(0,t.useEffect)(()=>{if(c&&o&&n)return f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{p()},Math.max(0,3e4-(Date.now()-d.current))),()=>{f.current&&clearTimeout(f.current)}},[c,o,n,p]),(0,t.useEffect)(()=>{if(!c||!o)return;let e=e=>{p(),e.preventDefault(),e.returnValue=""};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[c,o,p]);let m=(0,t.useCallback)(()=>(h(null),u),[u]);return{hasRecoveryData:null!==u,recoveryData:u,recover:m,discard:(0,t.useCallback)(()=>{h(null);try{localStorage.removeItem(r.CHARACTER_EDITOR_STORAGE_KEY_AUTOSAVE)}catch{}},[]),clearAutoSave:(0,t.useCallback)(()=>{try{localStorage.removeItem(r.CHARACTER_EDITOR_STORAGE_KEY_AUTOSAVE)}catch{}},[]),saveNow:p}}e.s(["useAutoSave",()=>n],54750);var i=e.i(33712),l=e.i(72670);let s=r.CHARACTER_EDITOR_SNAPSHOTS_STORE;async function o(){let e=await (0,l.getSharedDatabase)();return e?e.objectStoreNames.contains(s)?e:(console.warn("Snapshots store not found in database. Please refresh the page to trigger database migration."),null):null}async function c(e){let t=await o();if(!t)throw Error("Snapshots not available. Please refresh the page.");if((await u(e.characterSetId)).length>=10)throw Error("Maximum of 10 snapshots per character set. Delete an existing snapshot first.");return new Promise((a,r)=>{let n=t.transaction([s],"readwrite").objectStore(s).put(e);n.onsuccess=()=>a(),n.onerror=()=>r(Error("Failed to save snapshot"))})}async function u(e){let t=await o();return t?new Promise((a,r)=>{let n=t.transaction([s],"readonly").objectStore(s).index("by-character-set").getAll(e);n.onsuccess=()=>{let e=n.result;e.sort((e,t)=>t.createdAt-e.createdAt),a(e)},n.onerror=()=>{r(Error("Failed to get snapshots"))}}):[]}async function h(e){let t=await o();return t?new Promise((a,r)=>{let n=t.transaction([s],"readonly").objectStore(s).get(e);n.onsuccess=()=>{a(n.result||null)},n.onerror=()=>{r(Error("Failed to get snapshot"))}}):null}async function d(e){let t=await o();if(!t)throw Error("Snapshots not available. Please refresh the page.");return new Promise((a,r)=>{let n=t.transaction([s],"readwrite").objectStore(s).delete(e);n.onsuccess=()=>a(),n.onerror=()=>r(Error("Failed to delete snapshot"))})}async function f(e,t){let a=await o();if(!a)throw Error("Snapshots not available. Please refresh the page.");let r=await h(e);if(!r)throw Error("Snapshot not found");let n={...r,name:t};return new Promise((e,t)=>{let r=a.transaction([s],"readwrite").objectStore(s).put(n);r.onsuccess=()=>e(),r.onerror=()=>t(Error("Failed to rename snapshot"))})}function p(e){let{characterSetId:r,enabled:n=!0}=e,[l,s]=(0,t.useState)([]),[o,h]=(0,t.useState)(!1),[p,m]=(0,t.useState)(null),g=(0,t.useCallback)(async()=>{if(!r||!n)return void s([]);h(!0),m(null);try{let e=await u(r);s(e)}catch(e){console.error("Failed to load snapshots:",e),m(e instanceof Error?e.message:"Failed to load snapshots"),s([])}finally{h(!1)}},[r,n]);(0,t.useEffect)(()=>{g()},[g]);let y=(0,t.useCallback)(async(e,t,n)=>{if(!r)return m("No character set ID"),!1;try{let l,s=(l=(0,a.binaryToBase64)((0,a.serializeCharacterRom)(t,n)),{id:(0,i.generateId)(),characterSetId:r,name:e,createdAt:Date.now(),binaryData:l,config:n,characterCount:t.length});return await c(s),await g(),!0}catch(e){return console.error("Failed to save snapshot:",e),m(e instanceof Error?e.message:"Failed to save snapshot"),!1}},[r,g]),E=(0,t.useCallback)(async e=>{try{let t,r=l.find(t=>t.id===e);if(!r)return m("Snapshot not found"),null;return t=(0,a.base64ToBinary)(r.binaryData),(0,a.parseCharacterRom)(t,r.config)}catch(e){return console.error("Failed to restore snapshot:",e),m(e instanceof Error?e.message:"Failed to restore snapshot"),null}},[l]);return{snapshots:l,loading:o,error:p,saveNewSnapshot:y,restore:E,remove:(0,t.useCallback)(async e=>{try{return await d(e),await g(),!0}catch(e){return console.error("Failed to delete snapshot:",e),m(e instanceof Error?e.message:"Failed to delete snapshot"),!1}},[g]),rename:(0,t.useCallback)(async(e,t)=>{try{return await f(e,t),await g(),!0}catch(e){return console.error("Failed to rename snapshot:",e),m(e instanceof Error?e.message:"Failed to rename snapshot"),!1}},[g]),refresh:g,isAtCapacity:l.length>=10,maxSnapshots:10}}e.s(["useSnapshots",()=>p],69771),e.s([],7259)}]);